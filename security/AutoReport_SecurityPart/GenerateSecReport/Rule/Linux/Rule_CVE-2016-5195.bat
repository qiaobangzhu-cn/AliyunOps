@echo off
SetLocal EnableDelayedExpansion
rem rule CVE-2016-5195

rem local users to gain privileges

rem Race condition in mm/gup.c in the Linux kernel 2.x through 4.x before 4.8.3 allows local users to gain privileges
rem by leveraging incorrect handling of a copy-on-write (COW) feature to write to a read-only memory mapping, as exploited in the wild in October 2016, aka "Dirty COW." 

rem < Ubuntu 16.04.2 LTS
rem < CentOS 6.8
rem < CentOS 7.1

set Affected=1
set NotAffected=0

set InsInfoFile=%~1

call GetKeyValue.bat "%InsInfoFile%" "distribution"
set distribution=%Value%

set Return=%NotAffected%

rem < Ubuntu 16.04.2 LTS
echo !distribution!|findstr /i /r /c:"^Ubuntu" > nul
if NOT errorlevel 1 (
	for /f "tokens=2" %%A in ("!distribution!") do call VersionComp.bat 16.04.2 %%~A
	if !errorlevel! equ 1 set Return=!Affected!
)

rem < CentOS 6.8
echo !distribution!|findstr /i /r /c:"^CentOS 6." > nul
if NOT errorlevel 1 (
	for /f "tokens=2" %%A in ("!distribution!") do call VersionComp.bat 6.8 %%~A
	if !errorlevel! equ 1 set Return=!Affected!
)

rem < CentOS 7.1
echo !distribution!|findstr /i /r /c:"^CentOS 7." > nul
if NOT errorlevel 1 (
	for /f "tokens=2" %%A in ("!distribution!") do call VersionComp.bat 7.1 %%~A
	if !errorlevel! equ 1 set Return=!Affected!
)

exit/b %Return%
