@echo off
SetLocal EnableDelayedExpansion
rem rule CVE-2017-3733

rem Remote Code Execution

rem OpenSSL Encrypt-Then-Mac renegotiation DDOS

rem = 1.1.0
rem = 1.1.0a
rem = 1.1.0b
rem = 1.1.0c
rem = 1.1.0d

set Affected=1
set NotAffected=0

set InsInfoFile=%~1

call GetKeyValue.bat "%InsInfoFile%" "openssl"
set openssl=%Value%

set Return=%NotAffected%

for /f "delims=-" %%A in ("!openssl!") do set OpensslVersion=%%A

if "!OpensslVersion!"=="1.1.0"  set Return=!Affected!
if "!OpensslVersion!"=="1.1.0a" set Return=!Affected!
if "!OpensslVersion!"=="1.1.0b" set Return=!Affected!
if "!OpensslVersion!"=="1.1.0c" set Return=!Affected!
if "!OpensslVersion!"=="1.1.0d" set Return=!Affected!

exit/b %Return%
