@echo off
SetLocal EnableDelayedExpansion
rem rule CVE-2016-10229

rem Linux Kernel 'ipv4/udp.c' Remote Code Execution Vulnerability

rem udp.c in the Linux kernel before 4.5 allows remote attackers to execute arbitrary code via UDP traffic
rem that triggers an unsafe second checksum calculation during execution of a recv system call with the MSG_PEEK flag

rem RHEL 5/6/7 does NOT affected https://access.redhat.com/security/cve/cve-2016-10229

set Affected=1
set NotAffected=0

set InsInfoFile=%~1

rem Affected If Linux kernel before 4.5
set RuleData=4.5

call GetKeyValue.bat "%InsInfoFile%" "kernel"
set kernel=%Value%

call VersionComp.bat %RuleData% %kernel%
if %errorlevel% equ 1 (
	set Return=!Affected!
	call GetKeyValue.bat "%InsInfoFile%" "distribution"
	set distribution=!Value!
	rem CentOS 5/6/7
	echo !distribution!|findstr /i /r /c:"^CentOS [5-7]" > nul
	if NOT errorlevel 1 set Return=%NotAffected%
) else set Return=%NotAffected%

exit/b %Return%
